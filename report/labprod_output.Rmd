
```{r, echo=FALSE}


# Input panels for indicator and industry
  checkboxGroupInput(inputId = "variable_prod", label = "Choose a productivity indicator",
                         choices = list("Only domestic workers"="Only domestic workers",
                                        "Total jobs in firms"="Total jobs in firms",
                                        "Domestic and cross-border workers"="Domestic and cross-border workers"),
                         selected = "Only domestic workers",
                         inline = T)

    # radioButtons("variable_prod", "Choose a productivity indicator with:",
    #                choices = list("Only domestic workers"="Only domestic workers",
    #                               "Total jobs in firms"="Total jobs in firms",
    #                               "Domestic and cross-border workers"="Domestic and cross-border workers"),
    #                      selected = "Only domestic workers",
    #                      inline = TRUE)

  pickerInput(inputId = "ind.name_prod",
              label = "Choose industry", 
              choices= sort(unique(labprod$ind.name)),
              selected = c("Pharmaceutical products"),
              options = list(`actions-box` = TRUE),
              multiple = TRUE)

  renderPlotly({

# subset the data according to the input:
  d_output <- reactive({labprod %>%
                        filter(variable %in% input$variable_prod,
                               ind.name %in% input$ind.name_prod)
      })
  
if(nrow(d_output()) != 0){
# make the plot
  Y_MAX <- max(d_output()$value, na.rm = TRUE)
  ggplotly(  
           ggplot(d_output(),aes(x = as.numeric(year), y = value, 
                                 group = interaction(ind.name, variable, sep = ": "), 
                                 colour = ind.name, linetype  = variable, label = Industry)) +
           geom_point(alpha = 0.7) +  
           scale_colour_brewer(palette = "RdBu") +
            geom_line()+
            xlab("Year")+
            ylab(input$variable_prod)+
            ylim(0, Y_MAX)+
            guides(color = FALSE)+
            scale_x_continuous(breaks = seq(min(d_output()$year), max(d_output()$year), by = 5)) +
            theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line()
                       ), dynamicTicks = T, tooltip = c("label")) %>%
                          config(displayModeBar = F) %>%
                          layout(xaxis = list(fixedrange=T, rangeslider = list(type = "date", visible=T)
                          )) %>%
                          layout(#yaxis = list(fixedrange=T),
                                 legend = list(orientation = "h"))
    
} else{}  
  })

  # @CR: Somehow it doesn't take the ylim() from ggplot (added by me) i.e. plotly seems to overwrite the yaxis
  # even though it is out-commented in the layou() now. Havent found a solution yet

  
```
