```{r, echo=FALSE}

# Preparing tech field labels and filtering data

tech_label <- readRDS("oecd_tech_field.RDS")
colnames(tech_label) <- c("tech_field", "tech_name")

numpat_data<-merge(numpat_data, tech_label)
numpat_data <- filter(numpat_data, geo_level ==" ctry")

numpat_data <-subset(numpat_data, select = c("p_year", "tech_field", "tech_name","ctry_code", "Country", "indicator", "share_inv"))
unique(numpat_data$indicator)
numpat_data <- filter(numpat_data, indicator =="abs" | indicator =="share_pharma_total" | indicator =="rca_pharma_total")
numpat_data <- filter(numpat_data, p_year <=2015)
numpat_data <- dplyr::mutate(numpat_data, indicator = case_when(indicator == "abs" ~ "Absolute numbers", indicator == "share_pharma_total" ~ "% total patents", indicator == "rca_pharma_total" ~ "RCA pharma patents"))

# Input panels for indicator and industry
      radioButtons("indicator", "Choose an indicator",
                   choices = list("Absolute numbers"="Absolute numbers",
                                  "% total patents"= "% total patents", 
                                  "RCA pharma patents"="RCA pharma patents"),
                   selected = "% total patents")

      selectizeInput("Country", "Choose a country",
                     choices = c(numpat_data$Country),multiple = TRUE, selected = "Switzerland")

  renderPlotly({

# subset the data accoding to the input:
  dr <- reactive({numpat_data %>%
                  filter(indicator %in% input$indicator,
                         Country %in% input$Country)
      }) 

# make the plot
  ggplotly(  
      ggplot(dr(),aes(x = as.numeric(p_year), y = share_inv, group = Country, colour = Country)) +
geom_point(alpha = 0.7) +  
            geom_line()+
            xlab("Year") + 
            ylab(input$indicator)+
            guides(color = FALSE)+
            scale_x_continuous(breaks = seq(min(dr()$p_year), max(dr()$p_year), by = 5)) +
                 theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line()
                       ), dynamicTicks = T) %>%
                          config(displayModeBar = F) %>%
                          layout(xaxis = list(fixedrange=F, 
                          rangeslider = list(type = "date", visible=T))) %>%
                          layout(yaxis = list(fixedrange=F)      )
    
  })

```
