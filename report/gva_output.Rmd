
```{r, echo=FALSE}
# Prepare the data
    gva <- mutate(gva, variable = case_when(variable == "gva_prchange" ~ "GVA percentage change", 
                                            variable == "gva_abs" ~ "GVA in millions CHF",
                                            variable == "gva_share" ~ "Share in GDP"
                                            )) %>%
          mutate(Industry = paste0(ind.name, "\nYear: ", year, "\nIndicator: ", variable, "\nValue: ", round(value, 2)))


# Input panels for indicator and industry
radioButtons("variable_gva", "Choose a variable",
          choices = list("Share in GDP" = "Share in GDP",
                         "GVA in millions CHF" = "GVA in millions CHF", 
                         "GVA percentage change" = "GVA percentage change"),
          selected = "Share in GDP", 
          inline = T)
          
selectizeInput("ind.name_gva", "Choose industries",
      choices = unique(gva$ind.name), multiple = TRUE, selected = "Manufacture of basic pharmaceutical products and pharmaceutical preparations")
  
renderPlotly({
# subset the data according to the input:
  d_gva <- reactive({ gva %>%
                    filter(variable %in% input$variable_gva,
                           ind.name %in% input$ind.name_gva)
      }) 

# make the plot
  ggplotly(  
    ggplot(d_gva(),aes(x = as.numeric(year), y = value, group = ind.name, colour = ind.name, label = Industry)) +
        geom_point(alpha = 0.7) +  
            geom_line()+
            xlab("Year")+
            ylab(input$variable_gva)+
            guides(color = FALSE)+
            scale_x_continuous(breaks = seq(min(d_gva()$year), max(d_gva()$year), by = 5)) +
                 theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line(),
                       legend.position="bottom"
                       ), dynamicTicks = T,  tooltip = c("label")) %>%
                          config(displayModeBar = F) %>%
                          layout(xaxis = list(fixedrange=F 
                          # , rangeslider = list(type = "date", visible=T)
                          )) %>%
                          layout(yaxis = list(fixedrange=F),
                                 legend = list(orientation = "h"))
    
  })

```
