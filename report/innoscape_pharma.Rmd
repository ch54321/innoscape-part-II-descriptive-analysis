---
output: 
   html_document:
      css: style.css
runtime: shiny
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
library(ggplot2)
library(xtable)
library(DT)
library(viridis)
library(RColorBrewer)
library(knitr)
library(png)
library(cowplot)
library(plotly)
library(viridis)
library(autoimage)
library(shinyWidgets)
library(plyr)
library(dplyr)
library(data.table)
source_rmd <- function(rmd_file){
  knitr::knit(rmd_file, output = tempfile())
}
```

<!-- <head> -->
<!-- <!-- Global site tag (gtag.js) - Google Analytics --> -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-71167447-1"></script> -->
<!-- <script> -->
<!--   window.dataLayer = window.dataLayer || []; -->
<!--   function gtag(){dataLayer.push(arguments);} -->
<!--   gtag('js', new Date()); -->
<!--   gtag('config', 'UA-71167447-1'); -->
<!-- </script> -->
<!-- </head> -->

```{r, echo = F}
# Load data
dat_ii <- readRDS("num_pat_16.rds") %>% data.frame() 
dat_ii <- filter(dat_ii, n_ipc > 1000)
dat_ii_world <- readRDS("world_class_16.rds") %>% data.frame()
dat_ii <- mutate(dat_ii, geo_level = case_when(is.na(conti) != T ~ "conti", is.na(ctry_code) != T ~ " ctry", is.na(Up_reg_label) != T ~ "regio"))
dat_ii <- setDT(dat_ii)[, ges_pat_geo := sum(share_inv[abs_rel == "abs" & ipc_3 == "all"]), .(geo)]
dat_ii <- setDT(dat_ii)[, `Rank based on total patents` := dense_rank(desc(ges_pat_geo)), .(geo_level)]
## Calculate yearly share of an geographic region 
dat_ii <- setDT(dat_ii)[, ges_pat_year := sum(share_inv[abs_rel == "abs" & ipc_3 == "all"]), .(p_year)]
dat_ii <- setDT(dat_ii)[, ges_pat_geo_year := sum(share_inv[abs_rel == "abs" & ipc_3 == "all"]), .(geo, p_year)]
dat_ii <- mutate(dat_ii, share_geo = ges_pat_geo_year / ges_pat_year)
dat_ii <- dplyr::rename(dat_ii, Continent = conti, Region = Up_reg_label, Country = ctry_name)
dat_ii <- as.data.frame(dat_ii)
```


<br>

[![Foo](cieb_logo.jpg){ width=18% }](http://cieb.unibas.ch/)&nbsp;&nbsp;

## <font color="grey"> **Innoscape: Descriptive Analysis of Pharma Innovations** </font>

*June 2020* <a href="https://cieb.unibas.ch/de/team/dragan-filimonovic/" target = "_blank">Dragan Filimonovic</a>, <a href="https://cieb.unibas.ch/de/team/matthias-niggli/" target = "_blank">Matthias Niggli</a> and <a href="https://cieb.unibas.ch/de/team/dr-christian-rutzer/" target = "_blank">Christian Rutzer</a>


<br>

<br>

#### <font color='grey'> **Development of the Pharma Sector in Switzerland ** </font>


<br>
<br>

## {.tabset}

### Continents

```{r, echo = F, child = file.path(knitr::opts_knit$get("output.dir"), "conti_func.RMD")}
```

HERE short description of the findings at the continent level


### Countries

```{r, echo = F, child  = file.path(knitr::opts_knit$get("output.dir"), "ctry_func.Rmd")}
```


HERE short description of the findings at the country level


### Regions

```{r, echo = F, child  = file.path(knitr::opts_knit$get("output.dir"),'regio_func.Rmd')}
```




HERE short description of the findings at the regional level

## {.unlisted .unnumbered}
