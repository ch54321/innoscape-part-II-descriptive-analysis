```{r, echo = F}
select_country <- distinct(numpat_data, Country, `Rank based on year 2000`)  %>% 
  na.omit() %>% arrange(`Rank based on year 2000`)


output$country <- DT::renderDT(select_country, server = F, extensions = 'Scroller',  
                  filter = "top", # location of column filters
                  rownames= FALSE,
                  class = "display nowrap compact", 
                  selection = list(mode = 'multiple', selected = which(select_country$Country %in% c("Germany", "Switzerland", "United States"))),
                  options = list(scrollY = 180, scroller = TRUE, dom = 't', scrollX= T,
         			columnDefs = list(list(className = 'dt-center', targets = 1))))


selectedRow_ctry <- eventReactive(input$country_rows_selected,{
   select_country[input$country_rows_selected, "Country"]
  })

DT::dataTableOutput('country')

## Add clearing of rows
proxy_ctry <- dataTableProxy('country')
actionButton('clear_ctry', 'Clear Selection')
observeEvent(input$clear_ctry, {
    proxy_ctry %>% selectRows(NULL)
  })


# Input panels for indicator 
radioButtons("ind_ctry", "Choose an indicator",
                   choices = list("Absolute numbers"="Absolute numbers",
                                  "% of total patents"= "% of total patents", 
                                  "RCA of pharma patents"="RCA of pharma patents"),
                   selected = "% of total patents", 
                   inline = T)

# subset the data according to the input:
plot02_data_country <- reactive({numpat_data %>%
                        filter(geo %in% selectedRow_ctry(),
                               indicator %in% input$ind_ctry)
      }) 



## Create plot
renderPlotly({
                 ggplotly(
                 ggplot(data = plot02_data_country(), aes(x = p_year, y= share_inv, color = Country, shape = geo, label = Geo)) +
                 geom_point(alpha = 0.7) +
                 geom_line() +
                 # geom_text(aes(label = NOGA2digit), size = 4, check_overlap = FALSE, position = position_nudge(y = +0.1))+
                 xlab("Priority Year")+
                 ylab(input$ind_ctry)+
                 guides(color = FALSE)+
                scale_color_manual(values = colorRampPalette(brewer.pal(11, "RdBu"))(length(unique(plot02_data_country()$Country)))[seq(1, length(unique(plot02_data_country()$Country)), 1)]) +
                 scale_x_continuous(breaks = seq(min(plot02_data_country()$p_year), max(plot02_data_country()$p_year), by = 5)) +
                 theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line(),
                       legend.title = element_blank()
                       ), dynamicTicks = T, tooltip = c("label")) %>%
                 config(displayModeBar = F) %>%
                 layout(xaxis = list(fixedrange=T, rangeslider = list(type = "date", visible=T)
                                )) %>%
                 layout(yaxis = list(fixedrange=T), legend = list(orientation = "h")) 

         })

        
```