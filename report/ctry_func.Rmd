```{r, echo = F}
select_country <- distinct(dat_ii, Country, `Rank based on total patents`)  %>% na.omit()


output$country <- DT::renderDT(select_country, server = F, extensions = 'Scroller',  
                  filter = "top", # location of column filters
                  rownames= FALSE,
                  class = "display nowrap compact", 
                  selection = list(mode = 'multiple', selected = which(select_country$Country %in% c("Germany", "Switzerland", "United States"))),
                  options = list(scrollY = 180, scroller = TRUE, dom = 't', scrollX= T,
         			columnDefs = list(list(className = 'dt-center', targets = 1))))


selectedRow_ctry <- eventReactive(input$country_rows_selected,{
   select_country[input$country_rows_selected, "Country"]
  })

DT::dataTableOutput('country')

# renderText(selectedRow_ctry())

## Add clearing of rows
proxy_ctry <- dataTableProxy('country')
actionButton('clear_ctry', 'Clear Selection')
observeEvent(input$clear_ctry, {
    proxy_ctry %>% selectRows(NULL)
  })



## Add button to choose between absolut and relative value
actionButton('abs_rel_country', "Absolute value / relative to 1990")
abs_rel_country <- eventReactive(input$abs_rel_country,{
ifelse(input$abs_rel_country %in% c(0, seq(2, 1000, 2)), "abs", "rel_1990")}, ignoreNULL = FALSE)

## Add button to choose between absolute value or share relative to overall patents for a given year
actionButton("geo_share_ctry", "Absolute value / share")
geo_share_ctry <- eventReactive(input$geo_share_ctry, {ifelse(input$geo_share_ctry %in% c(0, seq(2, 1000, 2)), "abs", "rel")}, ignoreNULL = FALSE)


## Create plot
renderPlotly({
  plot02_data_country <- filter(dat_ii, Country %in% selectedRow_ctry() & abs_rel %in% abs_rel_country())


        # make the plot
                 ggplotly(
                 ggplot(data = plot02_data_country, aes(x = p_year, y= share_inv, color = Country, shape = geo)) +
                 geom_point(alpha = 0.7) +
                 geom_line() +
                 # geom_text(aes(label = NOGA2digit), size = 4, check_overlap = FALSE, position = position_nudge(y = +0.1))+
                 xlab("Priority Year")+
                 ylab("Number of patents")+
                 guides(color = FALSE)+
                 scale_x_continuous(breaks = seq(min(plot02_data_country$p_year), max(plot02_data_country$p_year), by = 5)) +
                 theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line()
                       ), dynamicTicks = T) %>%
                 config(displayModeBar = F) %>%
                 layout(xaxis = list(fixedrange=F, 
                                rangeslider = list(type = "date", visible=T))) %>%
                 layout(yaxis = list(fixedrange=F)) 

         })

        
```