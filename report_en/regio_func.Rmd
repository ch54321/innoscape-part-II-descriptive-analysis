```{r, echo = F, optipng = '-o7'}

select_regio <- distinct(numpat_data, Region, `Rank based on year 2000`)  %>% 
  na.omit() %>% arrange(`Rank based on year 2000`)

output$regio <- DT::renderDT(select_regio, server = F, extensions = 'Scroller',  
                  filter = "top", # location of column filters
                  rownames= FALSE,
                  class = "display nowrap compact", 
                  selection = list(mode = 'multiple', selected = which(select_regio$Region %in% c("CH - Northwestern Switzerland "))),
                  options = list(scrollY = 180, scroller = TRUE, dom = 't', scrollX= T,
         			columnDefs = list(list(className = 'dt-center', targets = 1))))


selectedRow_regio <- eventReactive(input$regio_rows_selected,{
   select_regio[input$regio_rows_selected, "Region"]
  })

DT::dataTableOutput('regio')

## Add clearing of rows
proxy <- dataTableProxy('regio')
actionButton('clear_reg', 'Clear Selection')
observeEvent(input$clear_reg, {
    proxy %>% selectRows(NULL)
  })

# Input panels for indicator 
radioButtons("ind_regio", "Choose an indicator",
                   choices = list("Absolute numbers"="Absolute numbers",
                                  "% of total patents"= "% of total patents", 
                                  "RCA of pharma patents"="RCA of pharma patents"),
                   selected = "% of total patents", 
                   inline = T)

# subset the data according to the input:
plot02_data_regio <- reactive({numpat_data %>%
                        filter(geo %in% selectedRow_regio(),
                               indicator %in% input$ind_regio)
      })

## Create plot
renderPlotly({
# make the plot
                 ggplotly(
                 ggplot(data = plot02_data_regio(), aes(x = p_year, y= share_inv, color = Region, shape = geo)) +
                 geom_point(alpha = 0.7) +
                 geom_line() +
                 # geom_text(aes(label = NOGA2digit), size = 4, check_overlap = FALSE, position = position_nudge(y = +0.1))+
                 xlab("Priority Year")+
                 ylab(input$ind_regio)+
                 guides(color = FALSE)+
  scale_color_manual(values = colorRampPalette(brewer.pal(8, "RdBu")[c(1:3, 6:8)])(length(unique(plot02_data_regio()$geo)))) +
                 scale_x_continuous(breaks = seq(min(plot02_data_regio()$p_year), max(plot02_data_regio()$p_year), by = 5)) +
                 theme(axis.title = element_text(face="bold",size = 10),
                       panel.background = element_blank(),
                       axis.line = element_line(),
                       legend.title = element_blank()
                       ),
                 dynamicTicks = T, tooltip = "label") %>%
                 config(displayModeBar = F) %>%
                 layout(xaxis = list(fixedrange=T, rangeslider = list(type = "date", visible=T)
                                )) %>%
                 layout(yaxis = list(fixedrange=T), legend = list(orientation = "h")) 

         })

        
```
